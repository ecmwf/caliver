<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An introduction to the caliver package • caliver</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="An introduction to the caliver package">
<meta property="og:description" content="caliver">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">caliver</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://doi.org/10.1371/journal.pone.0189419" class="external-link">PLOS ONE paper</a>
    </li>
    <li>
      <a href="../articles/index.html">Vignettes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ecmwf/caliver/" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="caliver_intro-vignette_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>An introduction to the caliver package</h1>
                        <h4 data-toc-skip class="author">Claudia Vitolo</h4>
            
            <h4 data-toc-skip class="date">2022-02-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ecmwf/caliver/blob/HEAD/vignettes/caliver_intro-vignette.Rmd" class="external-link"><code>vignettes/caliver_intro-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>caliver_intro-vignette.Rmd</code></div>

    </div>

    
    
<p><strong><em>NOTE: This vignette is an updated and extended version of <span class="citation">(Vitolo, Di Giuseppe, and D’Andrea 2018)</span>, since the publication of this PlosONE paper some functionalities have changed or have been deprecated (e.g. <code>get_gfed4()</code> to get data from the Global Fire Emissions Database).</em></strong></p>
<div class="section level2">
<h2 id="abstract">Abstract<a class="anchor" aria-label="anchor" href="#abstract"></a>
</h2>
<p>The name <code>caliver</code> stands for <strong>CALI</strong>bration and <strong>VER</strong>ification of (forest fire) gridded model outputs. This is a package developed for the R programming language and available under an APACHE-2 license from a public repository.</p>
<p>The caliver package was initially designed for the post-processing, calibration and validation/verification of Forest Fire Danger Forecasting models but as development progressed, it became clear that it could have a much wider applicability. The goal of this vignette is to describe the functionalities of the package, examples are given with regards to outputs of the following forest fire models: GEFF and RISICO.</p>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Forecasting wildfires is a complex task, theoretically challenging and computationally demanding. From a theoretical point of view, fires are difficult to predict as they depend on a stochastic (unpredictable) component: the ignition. The trigger can be natural in origin like lightning and self-combustion. But it can also be due to human behavior as intentional act of arson or unintentional act of negligence. Quite commonly human-caused ignition is performed to encourage regeneration and biodiversity in the forest ecosystem or replace forest vegetation with agricultural crops <span class="citation">(Vélez 2002, @McFarlane_etal_2002)</span>.</p>
<p>Once a fire is ignited, its spread, sustainability, and difficulty of control is almost exclusively determined by weather conditions <span class="citation">(Flannigan et al. 2009)</span>. Flames tend to rage out of control if certain soil and atmospheric conditions are met. As the ignition is casual and very difficult to predict, fire prediction systems, used in forest management, are design to highlight these favorable weather conditions which would allow sustained fire activity and not actual fire activities. On these premises is based one of the most widespread fire danger rating system, the Canadian forest service’s Fire Weather Index (FWI) <span class="citation">(Van Wagner and others 1974, 1333:@van1987development)</span> which is selected here to showcase the capability of the proposed package.</p>
<p>The FWI is a measure of fire potential and is expressed as a numeric rating. Rating rises as fire weather becomes more severe. By construction, the relationship between the FWI numerical values and the fuel status, such as the humidity content retained in the live or dead vegetation, is weak. This implies that the same FWI values can correspond to different danger levels depending on the ecosystem. To become a meaningful tool in fire management, the FWI requires the definition of danger levels that should be site specific (we call this post-processing task ‘calibration’ hereafter). Indeed the warning levels suggested for the original FWI were derived to describe fires in a standard jack pine stand, typical of the Canadian forests. Therefore the applicability of the FWI to other parts of the planet, with vegetation characteristics dissimilar from those of the Boreal forests, requires the user to understand the fire occurrence pattern in relation to the site specific conditions. Moreover, before transferring a fire danger system from one area to another, an extensive validation/verification (the terms validation and verification are used as synonyms in this work) against forecasted and observed fire events is required to build operational confidence. In practical terms, the calibration task implies the analysis of the soil and weather conditions as synthesized by the FWI for a long period in the past, while the verification consists of the analysis of the performance of the system and danger levels applied to observed events.</p>
<p>From a computational point of view tailoring fire danger levels to a given area and validating the performances of an early warning system is a demanding task as it requires handling large datasets. The typical user of fire forecasting systems might not necessarily have access to powerful supercomputers or large data storages. There is a need, therefore, to design and implement post-processing algorithms in such a way that processing time and memory resources are kept to the minimum while relying on accessible hardware.</p>
<p>In the light of these requirements, we have developed an open-source tool called caliver that contains reproducible algorithms for the calibration and verification of the FWI danger levels. This is developed in the R statistical language <span class="citation">(RCore 2016)</span>, it is available from a public repository and distributed under an open license.</p>
<p>The calibration and verification methodologies implemented in caliver rely on the availability of long term datasets of predicted and observed fire events. In the present work we test the algorithms using the FWI predictions that the European Centre for Medium-range Weather Forecasts (ECMWF) provides to the European Forest Fire Information System (EFFIS). The modeling component of EFFIS is referred to as the Global ECMWF Fire Forecast system (GEFF, <span class="citation">(Di Giuseppe et al. 2016)</span>). Observed fires are provided by the the Global Fire Assimilation System, which is part of the Copernicus Atmospheric Management Service. Both datasets are publicly available under open licenses.</p>
<p>In the following sections we present the caliver R package, illustrate the main functionalities and show the results of our experiments focused on calculating and validating fire danger thresholds for various areas in Europe. Europe is taken as an example study area but the methods are applicable worldwide. This work stems from the user-driven <a href="https://www.copernicus.eu/en" class="external-link">Copernicus EU Programme</a> which aims at developing freely and openly accessible information services based on satellite Earth Observation and in situ data. We believe that developing transparent and reproducible analysis workflows, even more if implemented within open-source initiatives is a necessary step towards the implementation of reliable modelling tools. This is because reproducible workflows aim to streamline the processing tasks as they present ready-made solutions to efficiently manipulate complex and heterogeneous datasets. Also, opening the code to the scrutiny of other experts increases the chances to implement more robust solutions and avoids duplication of efforts.</p>
</div>
<div class="section level2">
<h2 id="package-installation-and-dependencies">Package installation and dependencies<a class="anchor" aria-label="anchor" href="#package-installation-and-dependencies"></a>
</h2>
<p>The <code>caliver</code> package is implemented in the R statistical language. Here we describe version 2.0.0, the latest stable release at the time of this writing. The package does not require compilation but depends on the following external libraries: the Geospatial Data Abstraction Library <span class="citation">(Warmerdam 2008)</span>, a translator library for raster and vector geospatial data formats, and the NetCDF4 library <span class="citation">(Rew and Davis 1990)</span>. A Dockefile is provided with the source code and docker image (ecmwf/caliver) is available from docker hub.</p>
<p>The <code>caliver</code> package is available on CRAN, therefore once all the dependencies are available, the package can be installed and loaded as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"caliver"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ecmwf.github.io/caliver/" class="external-link">"caliver"</a></span><span class="op">)</span></code></pre></div>
<p>Please note that in the code snippets, we mention functions belonging to packages other than caliver and base, using the convention <code>package_name::function_name</code>.</p>
<div class="section level3">
<h3 id="source-code-availability">Source code availability<a class="anchor" aria-label="anchor" href="#source-code-availability"></a>
</h3>
<p>Our work stands for the highest standards of scientific reproducibility from the computational point of view <span class="citation">(Añel 2011, @anel2017comment)</span>. Hence, caliver’s source code is hosted on a public repository, maintained using the git version control system and distributed under an open license: APACHE-2. Users can suggest changes and report bugs using the dedicated <a href="https://github.com/ecmwf/caliver/issues" class="external-link">issue tracking system</a>.</p>
</div>
<div class="section level3">
<h3 id="continuous-integration-and-unit-tests">Continuous integration and unit tests<a class="anchor" aria-label="anchor" href="#continuous-integration-and-unit-tests"></a>
</h3>
<p>In order to have a reliable development process, system dependencies, installation and basic functionalities are tested using GitHub Actions for continuous integration on windows and unix-based systems. Tests for the main functions are developed using the testthat framework <span class="citation">(Wickham 2011)</span>. Software metrics, in terms of code coverage status, are tracked using the <a href="https://about.codecov.io/" class="external-link">codecov platform</a>. The current release has a code coverage above 90%.</p>
</div>
</div>
<div class="section level2">
<h2 id="datasets-for-testing">Datasets for testing<a class="anchor" aria-label="anchor" href="#datasets-for-testing"></a>
</h2>
<p>For the purpose of this vignette, we will demostrate the <code>caliver</code> functionalities using the data products from the Global ECMWF Fire Forecast (GEFF) system feeding the European Forest Fire Information System (EFFIS) system as well as external data sources.</p>
<ul>
<li>EFFIS/GEFF - example forecast and reanalysis data for various events are available from the Zenodo wildfire community: <a href="https://zenodo.org/communities/wildfire" class="external-link uri">https://zenodo.org/communities/wildfire</a>.</li>
<li>External datasets - The caliver package includes a copy of some external datasets in the <code>inst/extdata</code> folder to be used for educational/demostration purpose only:
<ul>
<li>Global Fire Emissions Database (GFED4) basis regions, a map of 14 spatial polygons used to evaluate regional annual emission estimates. This map can be retrieved as SpatialPolygonsDataFrame (see <code>sp</code> package).</li>
<li>Fuel model map, a global map of fuels in NetCDF format.</li>
<li>RISICO map, an example map used by the RISICO model in binary format.</li>
</ul>
</li>
</ul>
<p>Get the GFED4 basis regions and plot them:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/edzer/sp/" class="external-link">"sp"</a></span><span class="op">)</span>
<span class="va">BasisRegions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"GFED4_BasisRegions.rds"</span>,
                                    package <span class="op">=</span> <span class="st">"caliver"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">BasisRegions</span><span class="op">)</span></code></pre></div>
<p>Europe can be subsetted from GFED4 basis regions and plotted as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Europe</span> <span class="op">&lt;-</span> <span class="va">BasisRegions</span><span class="op">[</span><span class="va">BasisRegions</span><span class="op">$</span><span class="va">Region</span> <span class="op">==</span> <span class="st">"EURO"</span>,<span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Europe</span><span class="op">)</span></code></pre></div>
<p>Countries administrative boundaries can be obtained from the <a href="https://gadm.org/" class="external-link">GADM</a> dataset using the function <code>getdata()</code> from the <code>raster</code> package. As an example, below we show how to obtain Italian administrative boundaries.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://rspatial.org/raster" class="external-link">"raster"</a></span><span class="op">)</span>
<span class="co"># Italy</span>
<span class="va">Italy</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html" class="external-link">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="st">"Italy"</span>, level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="the-effisgeff-datasets-reanalysis-and-forecasts">The EFFIS/GEFF datasets: reanalysis and forecasts<a class="anchor" aria-label="anchor" href="#the-effisgeff-datasets-reanalysis-and-forecasts"></a>
</h3>
<p>Since 2018, fire danger forecasts have been developed at ECMWF as a part of the Copernicus Emergency Management Services under the guidance of the Joint Research Centre (JRC). A subset of the EFFIS/GEFF data is feeding the <a href="https://effis.jrc.ec.europa.eu/" class="external-link">EFFIS</a> and <a href="https://gwis.jrc.ec.europa.eu/" class="external-link">GWIS</a> web portals; operational platforms to access timely information for fire danger at European and Global scale, respectively. 38 local and national authorities across Europe are part of the EFFIS network and have been relying on the GEFF outputs for an early identification of regions which might experience fire events due to the establishment of persistent drought conditions.</p>
<p>Two datasets are available: the GEFF-reanalysis and the GEFF-realtime. GEFF-reanalysis provides historical records of global fire danger conditions from 1980 to date. The historic record is not static but it is updated regularly following the availability of the atmospheric reanalysis datasets. Reanalysis datasets are used to define warning levels on the base of past events, therefore levels derived from them should not be considered static as changes in climatic conditions can alter them. There are currently 2 GEFF-reanalysis datasets, the first one (used mainly for educational purposes) is based on the atmospheric reanalysis dataset ERA-Interim <span class="citation">(Dee et al. 2011)</span>. The second dataset is based on the most recent atmospheric reanalysis ERA5 <span class="citation">(Hersbach et al. 2020)</span>.</p>
<p>GEFF-realtime provides real time deterministic high resolution and probabilistic fire danger forecasts up to 15 days ahead using weather forcings from the latest model cycle of the ECMWF weather forecast system. The real-time dataset is updated every day with a new set of forecasts. This dataset is used for operational monitoring of danger conditions. Real-time data can be obtain making a data request to the <a href="https://effis.jrc.ec.europa.eu/apps/data.request.form/" class="external-link">JRC</a>. For educational purposes only, data for various past events are available on the Zenodo wildfire community (<a href="https://zenodo.org/communities/wildfire" class="external-link uri">https://zenodo.org/communities/wildfire</a>).</p>
<p>In this vignette, the Fire Weather Index (from the homonymous Canadian system) ERA-Interim based reanalysis dataset is used to asses fire danger. This dataset has daily temporal resolution, global coverage (0.7 degrees, ~80 Km, with longitudes ranging between -180 to +180 in geographic coordinate systems) and spans from 1980-01-01 to 2018-12-31. It was computed by the European Centre for Medium-range Weather Forecast (ECMWF) and made available on <a href="https://doi.org/10.5281/zenodo.1065400" class="external-link">Zenodo</a>, for more details see <span class="citation">(Vitolo et al. 2019)</span>. Newer and more detailed fire danger reanalysis data are available from the <a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/cems-fire-historical?tab=overview" class="external-link">Copernicus Climate Data Store (CDS)</a>, for more details see <span class="citation">(Vitolo et al. 2020)</span>.</p>
<p>We assume the ERA-Interim based GEFF-reanalysis data have already been downloaded from Zenodo and locally available.</p>
<p>Data are aggregated into one NetCDF file and can be loaded as RasterBrick.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set working directory, if needed</span>
<span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="st">"~/repos/caliver_demo"</span><span class="op">)</span>

<span class="co"># Download FWI reanalysis (GEFF-ERA-Interim reanalysis v3.0, 7.5GB, https://doi.org/10.5281/zenodo.1065400) to the working directory</span>
<span class="va">fwi</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html" class="external-link">brick</a></span><span class="op">(</span><span class="st">"fwi.nc"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="masking-data-using-land-cover-maps">Masking data using land cover maps<a class="anchor" aria-label="anchor" href="#masking-data-using-land-cover-maps"></a>
</h3>
<p>Vegetation is the fuel for fire. In order to carry out an accurate estimation of fire danger worldwide it is important to use an homogeneous classification of land use and vegetation. The Global Wildfire Information System (GWIS) uses the Global Land Cover 2000 database and regional products for Africa, Asia, and Europe [JRC2003]. This map is publicly available and can be downloaded from <a href="https://forobs.jrc.ec.europa.eu/products/glc2000/glc2000.php" class="external-link">https://forobs.jrc.ec.europa.eu/products/glc2000/glc2000.php</a>. Other land cover maps exist (e.g. <a href="http://www.esa-landcover-cci.org/" class="external-link">Climate Change Initiative (CCI) Land Cover Maps</a> by the European Space Agency) and the reader is invited to download and use the map more suitable for the problem at hand.</p>
<p>The example below shows how to mask fire danger indices using the Global Land Cover 2000 map.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Global Land Cover 2000 (documentation: https://forobs.jrc.ec.europa.eu/data/products/glc2000/GLC2000_EUR_20849EN.pdf)</span>
<span class="co"># Get the map: https://forobs.jrc.ec.europa.eu/data/products/glc2000/glc2000_v1_1_Grid.zip</span>
<span class="co"># then unzip the folder in the working directory</span>

<span class="co"># Load map</span>
<span class="va">fuel</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span><span class="st">"./glc2000_v1_1_Grid/Grid/glc2000_v1_1/w001001.adf"</span><span class="op">)</span>

<span class="co"># If fuel and fwi have different extent and/or number of rows/cols, you will need to resample</span>
<span class="va">fuel</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/resample.html" class="external-link">resample</a></span><span class="op">(</span><span class="va">fuel</span>, <span class="va">fwi</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, method <span class="op">=</span> <span class="st">"ngb"</span>, progress <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span>

<span class="co"># Remove Bare Areas (19), Water Bodies (20), Snow and Ice (21), Artificial surfaces and associated areas (22), No data (23).</span>
<span class="va">fwi_masked</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_with_fuelmodel.html">mask_with_fuelmodel</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fwi</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, fuelmap <span class="op">=</span> <span class="va">fuel</span>, codes <span class="op">=</span> <span class="fl">19</span><span class="op">:</span><span class="fl">23</span><span class="op">)</span>

<span class="co"># Plot</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fwi_masked</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">120</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="package-functionalities">Package functionalities<a class="anchor" aria-label="anchor" href="#package-functionalities"></a>
</h2>
<p>The primary goal of the <code>caliver</code> package is to streamline the post-processing of GEFF model outputs and make the scientific workflow easily reproducible. For this reason, this section provides example applications in the form of short workflows. These are ordered chronologically, based on the sequential steps a modeller would perform to visually explore information, calibrate fire danger levels and validate them. This often results in an increasing level of complexity. To provide a concise description, each workflow is not a stand alone exercise but the result of one workflow is often used as input in the following ones.</p>
<div class="section level3">
<h3 id="mask-crop-and-subset">Mask, crop and subset<a class="anchor" aria-label="anchor" href="#mask-crop-and-subset"></a>
</h3>
<p>GEFF fire danger indices are characterized by three dimensions (latitude, longitude and time) and a variable for each index of interest. These can be masked and cropped to match a user-defined extent, this can be a geographical bounding box or a spatial polygon such as a given administrative boundary. The indices can also be subsetted over the layer index or the time dimension (e.g. to take into account only fire seasons). The function <code><a href="../reference/mask_crop_subset.html">mask_crop_subset()</a></code> wraps the functions <code><a href="https://rdrr.io/pkg/raster/man/mask.html" class="external-link">raster::mask()</a></code>, <code><a href="https://rdrr.io/pkg/raster/man/crop.html" class="external-link">raster::crop()</a></code> and <code><a href="https://rdrr.io/pkg/raster/man/subset.html" class="external-link">raster::subset()</a></code> and converts the result into a RasterLayer (single layer) or RasterBrick (multiple layers). The example below shows how to mask and crop the fwi brick over Italy, selecting only the reference period 1981-2010.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get indices for climatological reference period 1981-2010</span>
<span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fwi</span><span class="op">)</span>, start <span class="op">=</span> <span class="fl">2</span>, stop <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/raster/man/match.html" class="external-link">%in%</a></span> <span class="fl">1981</span><span class="op">:</span><span class="fl">2010</span><span class="op">)</span>
<span class="co"># Mask, crop and subset</span>
<span class="va">fwi_Italy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">fwi</span>, p <span class="op">=</span> <span class="va">Italy</span>, idx <span class="op">=</span> <span class="va">idx</span>, progress <span class="op">=</span> <span class="st">"text"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="plot-firegrams">Plot firegrams<a class="anchor" aria-label="anchor" href="#plot-firegrams"></a>
</h2>
<p>One way of comparing different forecast types (deterministic forecast vs probabilistic forecast) is to plot a <code>firegram</code>, which is the equivalent of a meteogram in the fire domain. This is particularly useful as a diagnostic tool for assessing the consistency between the two type of forecasts.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Set up a small raster structure</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>
<span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span>nrows <span class="op">=</span> <span class="fl">2</span>, ncols <span class="op">=</span> <span class="fl">2</span>,
            xmn <span class="op">=</span> <span class="fl">0</span>, xmx <span class="op">=</span> <span class="fl">360</span>, ymn <span class="op">=</span> <span class="op">-</span><span class="fl">90</span>, ymx <span class="op">=</span> <span class="fl">90</span>, vals <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>
<span class="co"># Generate dummy reanalysis (30 years)</span>
<span class="va">reanalysis</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html" class="external-link">brick</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10957</span>,
                          <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/setValues.html" class="external-link">setValues</a></span><span class="op">(</span><span class="va">r</span>,
                                                        <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>,
                                                        min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">reanalysis</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1981-01-01"</span><span class="op">)</span>,
                              to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2010-12-31"</span><span class="op">)</span>,
                              by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>
<span class="co"># Generate danger levels</span>
<span class="va">thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fire_danger_levels.html">get_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">reanalysis</span><span class="op">)</span>

<span class="co"># Generate dummy HRES forecast (10 days lead time)</span>
<span class="va">hres</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html" class="external-link">brick</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,
                          <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/setValues.html" class="external-link">setValues</a></span><span class="op">(</span><span class="va">r</span>,
                                                        <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>,
                                                        min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">hres</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2011-01-01"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="co"># Generate dummy ENS forecast (51 members and 15 days lead time)</span>
<span class="va">ens</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html" class="external-link">brick</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">51</span><span class="op">*</span><span class="fl">15</span><span class="op">)</span>,
                          <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/setValues.html" class="external-link">setValues</a></span><span class="op">(</span><span class="va">r</span>,
                                                        <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html" class="external-link">ncell</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span>,
                                                        min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ens</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2011-01-01"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span>, length.out <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>, <span class="fl">51</span><span class="op">)</span>

<span class="co"># Firegram</span>
<span class="fu"><a href="../reference/firegram.html">firegram</a></span><span class="op">(</span><span class="va">thresholds</span>, <span class="va">hres</span>, <span class="va">ens</span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="generate-daily-climatology">Generate daily climatology<a class="anchor" aria-label="anchor" href="#generate-daily-climatology"></a>
</h3>
<p>In order to understand how the fire index on a given day compares with climatological values (distribution of values during the same period in the past years, typical reference period is 1981-2010) we build a daily climatology for each day of interest. This can be done with the function <code><a href="../reference/daily_clima.html">daily_clima()</a></code>. The function takes as input <code>r</code> (a RasterBrick/Stack with daily fire indices over a number of years, e.g. <code>fwi_Italy</code> defined in previous examples) and a sequence of <code>dates</code>, it then extracts from <code>r</code> the period that spans 4 days before and after the given date in <code>dates</code> (total of 9 days) for all the years available in <code>r</code>. The result is a list of stacks (one stack per day of interest). If <code>dates</code> are undefined, the function will assume all the days in a leap year are needed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate the daily climatology for the period 10-20 August</span>
<span class="va">clima_Italy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/daily_clima.html">daily_clima</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">fwi_Italy</span>,
                           dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-08-10"</span><span class="op">)</span>,
                                            to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-08-20"</span><span class="op">)</span>,
                                            by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Please note that in <code>dates</code> the year is ignored!</p>
</div>
<div class="section level3">
<h3 id="generate-maps-of-percentiles">Generate maps of percentiles<a class="anchor" aria-label="anchor" href="#generate-maps-of-percentiles"></a>
</h3>
<p>For each index, calculating relevant quantiles cell by cell (over time) gives an indication of the local distribution of fire danger values. There are two common approaches to derive percentile maps for fire indices: * Approach A - the percentile is calculated over the full record available over a number of years, or during the fire season over a number of years. * Approach B - the percentile is calculated on the daily climatology. In both cases such a map can be generated using the function <code><a href="../reference/get_percentile_map.html">get_percentile_map()</a></code>.</p>
<div class="section level4">
<h4 id="approach-a-percentile-over-full-record">Approach A: percentile over full record<a class="anchor" aria-label="anchor" href="#approach-a-percentile-over-full-record"></a>
</h4>
<p>The example below uses the <code>fwi_Italy</code> (generated in a previous section) to produce three maps, corresponding to the 50th, 75th and 90th percentile respectively.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mapsA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_percentile_map.html">get_percentile_map</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">fwi_Italy</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>With this approach, the object <code>mapsA</code> is a RasterLayer (for one probability) or a RasterBrick (for more than one probability).</p>
</div>
<div class="section level4">
<h4 id="approach-b-percentile-over-daily-climatology">Approach B: percentile over daily climatology<a class="anchor" aria-label="anchor" href="#approach-b-percentile-over-daily-climatology"></a>
</h4>
<p>The example below uses the <code>clima_Italy</code> (generated in a previous section) to produce three maps, corresponding to the 50th, 75th and 90th percentile respectively.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mapsB</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_percentile_map.html">get_percentile_map</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">clima_Italy</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>With this approach, the object <code>mapsB</code> is a list of RasterLayers (for one probability) or a RasterBricks (for more than one probability). The elements of the lists are named after the related date.</p>
</div>
</div>
<div class="section level3">
<h3 id="plot-percentile-maps">Plot percentile maps<a class="anchor" aria-label="anchor" href="#plot-percentile-maps"></a>
</h3>
<p>Once percentile maps are generated, these can be conviniently plotted with the raster/caliver packages. The raster package provides convenient methods to plot many types of GIS layers. The caliver package builds upon these functionalities to generate pre-styled plots. The previously generated percentile maps could be visualised using the raster::plot method but the map would need to be further manipulated to overlay a background map and set the color scale to the same range so that multiple maps become comparable. The caliver function <code><a href="../reference/plot_percentile_map.html">plot_percentile_map()</a></code> performs these manipulations behind the scenes, incorporating a background map and placing multiple plots in a grid-like layout with the same color scale. In the example below we compare direct outputs using <code><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">raster::plot()</a></code> (top) versus <code><a href="../reference/plot_percentile_map.html">plot_percentile_map()</a></code> (bottom).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use the raster plot method</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mapsA</span>, main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FWI 50th perc."</span>, <span class="st">"FWI 75th perc."</span>, <span class="st">"FWI 90th perc."</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Use the caliver plot_percentile_map function</span>
<span class="fu"><a href="../reference/plot_percentile_map.html">plot_percentile_map</a></span><span class="op">(</span>maps <span class="op">=</span> <span class="va">mapsA</span>,
                    main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"FWI 50th perc."</span>, <span class="st">"FWI 75th perc."</span>, <span class="st">"FWI 90th perc."</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="classify-fire-danger-indices">Classify fire danger indices<a class="anchor" aria-label="anchor" href="#classify-fire-danger-indices"></a>
</h3>
<p>Given a raster containing a fire danger index, e.g. fwi, this can be transformed from a continuous rating to a categorical raster using <code><a href="../reference/classify_index.html">classify_index()</a></code> (which is a wrapper around raster::cut() with some default settings).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fwi_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/classify_index.html">classify_index</a></span><span class="op">(</span><span class="va">fwi_masked</span>, index <span class="op">=</span> <span class="st">"fwi"</span>, thresholds <span class="op">=</span> <span class="cn">NULL</span>, labels <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="fu">rasterVis</span><span class="fu">::</span><span class="fu">levelplot</span><span class="op">(</span><span class="va">fwi_class</span>, col.regions <span class="op">=</span> <span class="fu">caliver</span><span class="fu">:::</span><span class="va">effis_palette</span>, att <span class="op">=</span> <span class="st">"Class"</span><span class="op">)</span></code></pre></div>
<p>The categories of GEFF’s indices are pre-defined but can be overwritten by explicitly defining the input parameters <code>thresholds</code> and <code>labels</code>. The <code>effis_palette</code> is pre-defined in caliver, however, any custom palette can be used.</p>
</div>
<div class="section level3">
<h3 id="fire-danger-levels-">Fire danger levels.<a class="anchor" aria-label="anchor" href="#fire-danger-levels-"></a>
</h3>
<p>Raw values of fire indices are expressed as a continuous rating (e.g. FWI values are in the range [0, +Inf[, although very rarely above 100). In order to aid decision makers raw values are routinely converted into danger classes, based on predefined thresholds.</p>
<p>The European Forest Fire Information System (EFFIS) provides a set of fire danger thresholds/classes harmonized across Europe (<a href="https://effis.jrc.ec.europa.eu/about-effis/technical-background/fire-danger-forecast" class="external-link uri">https://effis.jrc.ec.europa.eu/about-effis/technical-background/fire-danger-forecast</a>). For instance, the FWI ranges are (upper bound excluded): * Very low = 0 - 5.2 * Low = 5.2 - 11.2 * Moderate = 11.2 - 21.3 * High = 21.3 - 38.0 * Very high = 38.0 - 50.0 * Extreme &gt; 50.0</p>
<p>In our experience, the above thresholds are particularly suited to assess fire danger in southern Europe, e.g. in the Mediterranean Region. Some countries, tend to calibrate these thresholds depending on local vegetation characteristics and fire regimes. This require local knowledge and/or experimentation. The caliver package provides some useful functionalities for this type of tasks.</p>
<p>The fire season is the period of the year during which 80% of wildfires have occurred. For historical analysis, this is defined <em>a posteriori</em> and changes year-on-year. However, a more simplistic approach assumes that the fire season is the period of the year in which <strong>wildfires are more likely to occur</strong> (this is also the assumption made by EFFIS). Therefore it often coincides with the dry season, a period in which there is a reduced soil moisture and precipitation. In this work we adopt a convention: the fire season falls between 1st April and 31st October in the northern hemisphere, and between 1st October and 30th April in the southern hemisphere. This convention is coded in the function <code><a href="../reference/get_fire_season.html">get_fire_season()</a></code>, which accepts at least two arguments: dates (the sequence of daily dates for which reanalysis data is available) and zone (which can be either ‘north’ or ‘south’ hemisphere). There are also two optional arguments that allow to define an ad-hoc fire season: fss (which stands for Fire Season Start) and fse (which stands for Fire Season End).</p>
<p>In order to calculate the danger classes, the FWI brick should be loaded and the indices corresponding to the local fire season should be identified. In the example below the fire season is assumed constant across Europe (and Italy in particular), starting in April and ending in October each year.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dataDates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fwi</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">11</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y.%m.%d"</span><span class="op">)</span>
<span class="co"># Define a function to extract fire seasons in Europe</span>
<span class="va">seasons</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fire_season.html">get_fire_season</a></span><span class="op">(</span>dates <span class="op">=</span> <span class="va">dataDates</span>, zone <span class="op">=</span> <span class="st">"north"</span><span class="op">)</span>

<span class="co"># Create an index of fire season dates</span>
<span class="va">fireSeasonIndex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">seasons</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Threshold for every area of interest are calculate on the subset of the FWI brick related to the fire season only and cropped over the area of interest. Below are examples calculated for various countries in Europe. <span class="citation">(Vitolo, Di Giuseppe, and D’Andrea 2018)</span> show that fire danger classes is generally correlated to the local climate and spatial variability appears to be meaningful up to regional level.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Mask/Crop/Subset FWI over Europe</span>
<span class="va">fwi_euro</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">fwi</span>, p <span class="op">=</span> <span class="va">Europe</span>, idx <span class="op">=</span> <span class="va">fireSeasonIndex</span><span class="op">)</span>

<span class="co"># Calculate homogenised fire danger levels (or thresholds) for Europe</span>
<span class="va">EuropeThr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fire_danger_levels.html">get_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">fwi_euro</span><span class="op">)</span>
<span class="va">EuropeThr</span></code></pre></div>
<p>Please note the differences between these danger levels and those recommended by EFFIS, <code>caliver</code> danger levels are generally lower than EFFIS ones.</p>
<p>Fire danger levels are more useful when calculated at country level. Below is shown how to execute the same steps above recursively for most countries in Europe and bind the results together in a summary table.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Country level: use a loop to calculate levels for three sample countries.</span>
<span class="co"># Please note that in the original paper many more countries were used, here we process</span>
<span class="co"># only three to reduce the processing time but the procedure is exactly the same.</span>
<span class="va">EUcountries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Spain"</span>, <span class="st">"GBR"</span>, <span class="st">"Italy"</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">country</span> <span class="kw">in</span> <span class="va">EUcountries</span><span class="op">)</span><span class="op">{</span>

  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span>
  <span class="va">country_poly</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html" class="external-link">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>,
                                  country <span class="op">=</span> <span class="va">country</span>,
                                  level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

  <span class="co"># Mask/Crop/Subset FWI and generate thresholds for country</span>
  <span class="va">country_fwi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">fwi_euro</span>, p <span class="op">=</span> <span class="va">country_poly</span><span class="op">)</span>
  <span class="va">country_thrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_fire_danger_levels.html">get_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">country_fwi</span><span class="op">)</span>
  
  <span class="co"># Append values to data.frame</span>
  <span class="kw">if</span> <span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Spain"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">country_thrs</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="kw">else</span><span class="op">{</span>
    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">country_thrs</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>

<span class="op">}</span>

<span class="va">df_thr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">EUcountries</span>, <span class="va">df</span>, stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_thr</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Country"</span>, <span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>, <span class="st">"VeryHigh"</span>, <span class="st">"Extreme"</span><span class="op">)</span></code></pre></div>
<p>Assessing the danger levels at regional and province level (using the ERA-Interim based dataset) is rather difficult because some areas are too small compared to the raster resolution. For assessing fire danger in small regions we suggest to use the ERA5-based fire indices <span class="citation">(Vitolo et al. 2020)</span>.</p>
<div class="section level4">
<h4 id="plot-density-with-thresholds">Plot density with thresholds<a class="anchor" aria-label="anchor" href="#plot-density-with-thresholds"></a>
</h4>
<p>The thresholds are different from the percentiles, the PDF below shows a comparison for Italy (the last country in the above loop).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">countryPDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_pdf.html">plot_pdf</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">country_fwi</span>,
                       thresholds <span class="op">=</span> <span class="va">country_thrs</span>, 
                       upper_limit <span class="op">=</span> <span class="fl">60</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level4">
<h4 id="validate-danger-levels">Validate danger levels<a class="anchor" aria-label="anchor" href="#validate-danger-levels"></a>
</h4>
<p>Test whether large fires correspond to FWI above high danger.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://expasy.org/tools/pROC/" class="external-link">"pROC"</a></span><span class="op">)</span>

<span class="co"># Assuming burned areas was downloaded and combined in a grid file,</span>
<span class="co"># this can be loaded as a brick:</span>
<span class="va">BurnedAreas</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html" class="external-link">brick</a></span><span class="op">(</span><span class="st">"GFED4_BurnedAreas/BurnedArea.grd"</span><span class="op">)</span>

<span class="co"># Mask and crop burned areas over Europe</span>
<span class="va">BA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">BurnedAreas</span>, p <span class="op">=</span> <span class="va">Europe</span><span class="op">)</span>

<span class="co"># If observations layers have no date, assign it!</span>
<span class="va">dataDates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2003-01-01"</span><span class="op">)</span>,
                      to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2015-12-31"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">BA</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">dataDates</span>

<span class="va">EuroThrHigh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_thr</span><span class="op">[</span><span class="va">df_thr</span><span class="op">$</span><span class="va">Country</span> <span class="op">==</span> <span class="st">"Europe"</span>, <span class="fl">4</span><span class="op">]</span><span class="op">)</span>

<span class="co"># The above can be saved and re-loaded as follows:</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">BA</span>, filename<span class="op">=</span><span class="st">"BurnedAreaEurope.grd"</span>,
                    bandorder<span class="op">=</span><span class="st">'BIL'</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span>, progress <span class="op">=</span> <span class="st">'text'</span><span class="op">)</span>
<span class="va">BurnedAreaEurope</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html" class="external-link">brick</a></span><span class="op">(</span><span class="st">"BurnedAreaEurope.grd"</span><span class="op">)</span>

<span class="co"># For the validation we do not want to subset over the fire season, subset to match days in BurnedAreaEurope</span>
<span class="va">FWIEURO</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWI</span>, p <span class="op">=</span> <span class="va">Europe</span>, idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">FWI</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/raster/man/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">BurnedAreaEurope</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co"># The above can be saved and re-loaded as follows:</span>
<span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span><span class="va">FWIEURO</span>, filename<span class="op">=</span><span class="st">"FWIEURO.grd"</span>, bandorder<span class="op">=</span><span class="st">'BIL'</span>, overwrite<span class="op">=</span><span class="cn">TRUE</span>, progress <span class="op">=</span> <span class="st">'text'</span><span class="op">)</span>
<span class="va">FWIEURO</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html" class="external-link">brick</a></span><span class="op">(</span><span class="st">"FWIEURO.grd"</span><span class="op">)</span>

<span class="co"># Contingency table for JRC - Europe as a whole</span>
<span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_fire_danger_levels.html">validate_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">FWIEURO</span>, observation <span class="op">=</span> <span class="va">BurnedAreaEurope</span>,
                                 fire_threshold <span class="op">=</span> <span class="fl">21.3</span>, obs_threshold <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="va">tab_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="va">x1</span><span class="op">$</span><span class="va">pred</span>, obs <span class="op">=</span> <span class="va">x1</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span>
<span class="va">hits</span> <span class="op">&lt;-</span> <span class="va">tab_x</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>
<span class="va">misses</span> <span class="op">&lt;-</span> <span class="va">tab_x</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>
<span class="va">correct_negatives</span> <span class="op">&lt;-</span> <span class="va">tab_x</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>
<span class="va">false_alarms</span> <span class="op">&lt;-</span> <span class="va">tab_x</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>
<span class="co"># POD 47%</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">hits</span><span class="op">/</span><span class="op">(</span><span class="va">hits</span><span class="op">+</span><span class="va">misses</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>
<span class="va">roc1</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu">roc</span><span class="op">(</span>response <span class="op">=</span> <span class="va">x1</span><span class="op">$</span><span class="va">obs</span>, predictor <span class="op">=</span> <span class="va">x1</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span>
<span class="fu">pROC</span><span class="fu">::</span><span class="fu">plot.roc</span><span class="op">(</span><span class="va">roc1</span>, print.auc <span class="op">=</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu">auc</span><span class="op">(</span><span class="va">roc1</span><span class="op">)</span>, print.auc.x <span class="op">=</span> <span class="fl">0</span>, print.auc.y <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span>

<span class="co"># Contingency table for caliver - Europe as a whole</span>
<span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_fire_danger_levels.html">validate_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">FWIEURO</span>, observation <span class="op">=</span> <span class="va">BurnedAreaEurope</span>,
                                 fire_threshold <span class="op">=</span> <span class="va">EuroThrHigh</span>, obs_threshold <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="va">tab_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span>pred <span class="op">=</span> <span class="va">x2</span><span class="op">$</span><span class="va">pred</span>, obs <span class="op">=</span> <span class="va">x2</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span>
<span class="va">hits</span> <span class="op">&lt;-</span> <span class="va">tab_x</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>
<span class="va">misses</span> <span class="op">&lt;-</span> <span class="va">tab_x</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>
<span class="co"># POD 65%</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">hits</span><span class="op">/</span><span class="op">(</span><span class="va">hits</span><span class="op">+</span><span class="va">misses</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span>
<span class="va">roc2</span> <span class="op">&lt;-</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu">roc</span><span class="op">(</span>response <span class="op">=</span> <span class="va">x2</span><span class="op">$</span><span class="va">obs</span>, predictor <span class="op">=</span> <span class="va">x2</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span>
<span class="fu">pROC</span><span class="fu">::</span><span class="fu">plot.roc</span><span class="op">(</span><span class="va">roc2</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>,
               print.auc <span class="op">=</span> <span class="fu">pROC</span><span class="fu">::</span><span class="fu">auc</span><span class="op">(</span><span class="va">roc2</span><span class="op">)</span>, print.auc.x <span class="op">=</span> <span class="fl">0</span>, print.auc.y <span class="op">=</span> <span class="fl">0.95</span>,
               print.auc.col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>

<span class="co"># Loop throught the countries</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">country</span> <span class="kw">in</span> <span class="va">df_thr</span><span class="op">[</span>,<span class="st">"Country"</span><span class="op">]</span><span class="op">)</span><span class="op">{</span>

  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span>

  <span class="va">countryPoly</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html" class="external-link">getData</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GADM"</span>, country <span class="op">=</span> <span class="va">country</span>, level <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
  <span class="va">countryThr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">df_thr</span><span class="op">[</span><span class="va">df_thr</span><span class="op">$</span><span class="va">Country</span> <span class="op">==</span> <span class="va">country</span>, <span class="fl">4</span><span class="op">]</span><span class="op">)</span>

  <span class="co"># Crop RasterBricks over country of interest</span>
  <span class="va">BA_country</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">BurnedAreaEurope</span>, p <span class="op">=</span> <span class="va">countryPoly</span><span class="op">)</span>
  <span class="va">FWI_country</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mask_crop_subset.html">mask_crop_subset</a></span><span class="op">(</span>r <span class="op">=</span> <span class="va">FWIEURO</span>, p <span class="op">=</span> <span class="va">countryPoly</span><span class="op">)</span>

  <span class="va">JRC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_fire_danger_levels.html">validate_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">FWI_country</span>,
                                     observation <span class="op">=</span> <span class="va">BA_country</span>,
                                     fire_threshold <span class="op">=</span> <span class="fl">21.3</span>,
                                     obs_threshold <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
  <span class="va">tab_JRC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">JRC</span><span class="op">$</span><span class="va">pred</span>, <span class="va">JRC</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span>
  <span class="va">caliver1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_fire_danger_levels.html">validate_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">FWI_country</span>,
                                          observation <span class="op">=</span> <span class="va">BA_country</span>,
                                          fire_threshold <span class="op">=</span> <span class="va">EuroThrHigh</span>,
                                          obs_threshold <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
  <span class="va">tab_caliver1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">caliver1</span><span class="op">$</span><span class="va">pred</span>, <span class="va">caliver1</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span>
  <span class="va">caliver2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_fire_danger_levels.html">validate_fire_danger_levels</a></span><span class="op">(</span>fire_index <span class="op">=</span> <span class="va">FWI_country</span>,
                                          observation <span class="op">=</span> <span class="va">BA_country</span>,
                                          fire_threshold <span class="op">=</span> <span class="va">countryThr</span>,
                                          obs_threshold <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
  <span class="va">tab_caliver2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">caliver2</span><span class="op">$</span><span class="va">pred</span>, <span class="va">caliver2</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span><span class="op">)</span>
    
  <span class="kw">if</span> <span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Spain"</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">df_caliver1</span> <span class="op">&lt;-</span> <span class="va">df_caliver2</span> <span class="op">&lt;-</span> <span class="va">df_effis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="st">"pred"</span> <span class="op">=</span> <span class="va">tab_caliver1</span><span class="op">$</span><span class="va">pred</span>, <span class="st">"obs"</span> <span class="op">=</span> <span class="va">tab_caliver1</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span>
    <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">3</span>
  <span class="op">}</span>

  <span class="va">df_caliver1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df_caliver1</span>, <span class="va">tab_caliver1</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver1</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">country</span>
  <span class="va">df_caliver2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df_caliver2</span>, <span class="va">tab_caliver2</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">country</span>
  <span class="va">df_effis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">df_effis</span>, <span class="va">tab_JRC</span><span class="op">$</span><span class="va">Freq</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_effis</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">country</span>
  <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span>

  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">countryPoly</span>, <span class="va">countryThr</span>, <span class="va">BA_country</span>, <span class="va">FWI_country</span><span class="op">)</span>

<span class="op">}</span>

<span class="co"># Save contingency tables</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">df_caliver1</span>, <span class="st">"df_caliver1.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">df_caliver2</span>, <span class="st">"df_caliver2.rds"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">df_effis</span>, <span class="st">"df_effis.rds"</span><span class="op">)</span>

<span class="co"># Europe (EFFIS danger levels)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_effis</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">27</span><span class="op">]</span><span class="op">)</span> <span class="co"># hits</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_effis</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">27</span><span class="op">]</span><span class="op">)</span> <span class="co"># misses</span>
<span class="co"># Europe (averaged danger levels)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_caliver1</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">27</span><span class="op">]</span><span class="op">)</span> <span class="co"># hits</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_caliver1</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">27</span><span class="op">]</span><span class="op">)</span> <span class="co"># misses</span>
<span class="co"># Europe (country-specific danger levels)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">27</span><span class="op">]</span><span class="op">)</span> <span class="co"># hits</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">27</span><span class="op">]</span><span class="op">)</span> <span class="co"># misses</span>

<span class="co"># UK (EFFIS danger levels)</span>
<span class="va">df_effis</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"United Kingdom"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_effis</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"United Kingdom"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
<span class="co"># UK (EU averaged danger levels)</span>
<span class="va">df_caliver1</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"United Kingdom"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_caliver1</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"United Kingdom"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
<span class="co"># UK (country-specific danger levels)</span>
<span class="va">df_caliver2</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"United Kingdom"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_caliver2</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"United Kingdom"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
                                                   
<span class="co"># Spain (EFFIS danger levels)</span>
<span class="va">df_effis</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Spain"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_effis</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Spain"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
<span class="co"># Spain (EU averaged danger levels)</span>
<span class="va">df_caliver1</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Spain"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_caliver1</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Spain"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
<span class="co"># Spain (country-specific danger levels)</span>
<span class="va">df_caliver2</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Spain"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_caliver2</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Spain"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
                                                   
<span class="co"># Italy (EFFIS danger levels)</span>
<span class="va">df_effis</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Italy"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_effis</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Italy"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
<span class="co"># Italy (EU averaged danger levels)</span>
<span class="va">df_caliver1</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Italy"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_caliver1</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Italy"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span>
<span class="co"># Italy (country-specific danger levels)</span>
<span class="va">df_caliver2</span><span class="op">[</span><span class="fl">4</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Italy"</span><span class="op">)</span><span class="op">]</span> <span class="co"># hits</span>
<span class="va">df_caliver2</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_caliver2</span><span class="op">)</span> <span class="op">==</span> <span class="st">"Italy"</span><span class="op">)</span><span class="op">]</span> <span class="co"># misses</span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references">
<div id="ref-anel2011importance">
<p>Añel, Juan A. 2011. “The Importance of Reviewing the Code.” <em>Communications of the ACM</em> 54 (5): 40–41.</p>
</div>
<div id="ref-anel2017comment">
<p>———. 2017. “Comment on ‘Most Computational Hydrology Is Not Reproducible, so Is It Really Science?’ By Christopher Hutton et Al.” <em>Water Resources Research</em> 53 (3): 2572–4.</p>
</div>
<div id="ref-dee2011era">
<p>Dee, Dick P, S Mꎬ Uppala, AJ Simmons, Paul Berrisford, P Poli, S Kobayashi, U Andrae, et al. 2011. “The Era-Interim Reanalysis: Configuration and Performance of the Data Assimilation System.” <em>Quarterly Journal of the Royal Meteorological Society</em> 137 (656): 553–97.</p>
</div>
<div id="ref-di2016potential">
<p>Di Giuseppe, Francesca, Florian Pappenberger, Fredrik Wetterhall, Blazej Krzeminski, Andrea Camia, Giorgio Libertá, and Jesus San Miguel. 2016. “The Potential Predictability of Fire Danger Provided by Numerical Weather Prediction.” <em>Journal of Applied Meteorology and Climatology</em> 55 (11): 2469–91.</p>
</div>
<div id="ref-Flannigan_etal_2009">
<p>Flannigan, Mike D, Meg A Krawchuk, William J de Groot, B Mike Wotton, and Lynn M Gowman. 2009. “Implications of Changing Climate for Global Wildland Fire.” <em>International Journal of Wildland Fire</em> 18 (5): 483–507.</p>
</div>
<div id="ref-hersbach2020era5">
<p>Hersbach, Hans, Bill Bell, Paul Berrisford, Shoji Hirahara, András Horányi, Joaquı́n Muñoz-Sabater, Julien Nicolas, et al. 2020. “The Era5 Global Reanalysis.” <em>Quarterly Journal of the Royal Meteorological Society</em> 146 (730): 1999–2049.</p>
</div>
<div id="ref-McFarlane_etal_2002">
<p>McFarlane, Paul, H. Pearce, and John Moore. 2002. “Introduction: Forestry and Risk Management - New Zealand in a Global Context.” In, 5–19.</p>
</div>
<div id="ref-rcore2016r">
<p>RCore, TEAM. 2016. “R: A Language and Environment for Statistical Computing. R Foundation for Statistical Computing, Vienna, Austria.”</p>
</div>
<div id="ref-rew1990netcdf">
<p>Rew, Russ, and Glenn Davis. 1990. “NetCDF: An Interface for Scientific Data Access.” <em>IEEE Computer Graphics and Applications</em> 10 (4): 76–82.</p>
</div>
<div id="ref-van1987development">
<p>Van Wagner, CE, Petawawa Forest, and others. 1987. “Development and Structure of the Canadian Forest Fireweather Index System.” In <em>Can. For. Serv., Forestry Tech. Rep</em>. Citeseer.</p>
</div>
<div id="ref-van1974structure">
<p>Van Wagner, Charles Edward, and others. 1974. <em>Structure of the Canadian Forest Fire Weather Index</em>. Vol. 1333. Citeseer.</p>
</div>
<div id="ref-Velez2002">
<p>Vélez, R. 2002. “Causes of Forest Fires in the Mediterranean Basin.” <em>EFI Proceedings</em>, no. No.45: 35–42.</p>
</div>
<div id="ref-Vitolo2020">
<p>Vitolo, Claudia, Francesca Di Giuseppe, Christopher Barnard, Ruth Coughlan, Jesus San-Miguel-Ayanz, Giorgio Libertá, and Blazej Krzeminski. 2020. “ERA5-Based Global Meteorological Wildfire Danger Maps.” <em>Scientific Data</em> 7 (1): 216. <a href="https://doi.org/10.1038/s41597-020-0554-z" class="external-link">https://doi.org/10.1038/s41597-020-0554-z</a>.</p>
</div>
<div id="ref-vitolo:2018">
<p>Vitolo, Claudia, Francesca Di Giuseppe, and Mirko D’Andrea. 2018. “Caliver: An R Package for Calibration and Verification of Forest Fire Gridded Model Outputs.” <em>PLOS ONE</em> 13 (1): 1–18. <a href="https://doi.org/10.1371/journal.pone.0189419" class="external-link">https://doi.org/10.1371/journal.pone.0189419</a>.</p>
</div>
<div id="ref-Vitolo2019">
<p>Vitolo, Claudia, Francesca Di Giuseppe, Blazej Krzeminski, and Jesus San-Miguel-Ayanz. 2019. “A 1980–2018 Global Fire Danger Re-Analysis Dataset for the Canadian Fire Weather Indices.” <em>Scientific Data</em> 6 (1): 190032. <a href="https://doi.org/10.1038/sdata.2019.32" class="external-link">https://doi.org/10.1038/sdata.2019.32</a>.</p>
</div>
<div id="ref-warmerdam2008geospatial">
<p>Warmerdam, Frank. 2008. “The Geospatial Data Abstraction Library.” In <em>Open Source Approaches in Spatial Data Handling</em>, 87–104. Springer.</p>
</div>
<div id="ref-wickham2011testthat">
<p>Wickham, Hadley. 2011. “Testthat: Get Started with Testing.” <em>The R Journal</em> 3: 5–10. <a href="https://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf" class="external-link">https://journal.r-project.org/archive/2011-1/RJournal_2011-1_Wickham.pdf</a>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Francesca Di Giuseppe, Claudia Vitolo, Mirko D’Andrea.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
